# BackgroundWorker类

## BackgroundWorker.DoWork 事件

调用RunWorkerAsync方法时会引发此事件。这是您开始执行可能耗时的工作的操作的地方。

DoWork事件处理程序中的代码应定期检查CancellationPending属性值，如果为true则中止操作。发生这种情况时，可以将System.ComponentModel.DoWorkEventArgs的Cancel标志设置为true，并将RunWorkerCompleted事件处理程序中System.ComponentModel.RunWorkerCompletedEventArgs的Canceled标志设置为true。


请注意，DoWork事件处理程序中的代码可能会在发出取消请求时完成其工作，并且您的轮询循环可能会错过CancellationPending设置为true。在这种情况下，即使发出了取消请求，RunWorkerCompleted事件处理程序中System.ComponentModel.RunWorkerCompletedEventArgs的Canceled标志也不会设置为true。这种情况称为竞争条件，是多线程编程中的常见问题。有关多线程设计问题的更多信息，请参阅托管线程最佳实践。

如果您的操作产生结果，则可以将结果分配给DoWorkEventArgs.Result属性。这将在RunWorkerCompletedEventArgs.Result属性中的RunWorkerCompleted事件处理程序中可用。

如果操作代码引发了未处理的异常，则BackgroundWorker会捕获异常并将其传递到RunWorkerCompleted事件处理程序，并将其作为System.ComponentModel.RunWorkerCompletedEventArgs的Error属性公开。如果您在Visual Studio调试器下运行，则调试器将在DoWork事件处理程序中引发未处理的异常的位置中断。如果您有多个BackgroundWorker，则不应直接引用其中的任何一个，因为这会将您的DoWork事件处理程序耦合到BackgroundWorker的特定实例。相反，您应该通过在DoWork事件处理程序中强制转换sender参数来访问BackgroundWorker。

您必须小心不要操作DoWork事件处理程序中的任何用户界面对象。而是通过BackgroundWorker事件与用户界面进行通信。

有关如何处理事件的更多信息，请参阅处理和引发事件。

## BackgroundWorker.RunWorkerCompleted Event 
当后台操作已完成、被取消或引发异常时发生。

DoWork事件处理程序返回时引发此事件。

如果操作成功完成并且其结果在DoWork事件处理程序中分配，则可以通过RunWorkerCompletedEventArgs.Result属性访问结果。

System.ComponentModel.RunWorkerCompletedEventArgs的Error属性指示操作引发了异常。

System.ComponentModel.RunWorkerCompletedEventArgs的Canceled属性指示后台操作是否处理了取消请求。 如果DoWork事件处理程序中的代码通过检查CancellationPending标志并将System.ComponentModel.DoWorkEventArgs的Cancel标志设置为true来检测取消请求，则System.ComponentModel.RunWorkerCompletedEventArgs的Canceled标志也将设置为true。